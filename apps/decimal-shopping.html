<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å°æ•°ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
  <meta name="description" content="ãƒ‰ãƒ©ãƒƒã‚°ã§ ã‹ã„ã‚‚ã®ï¼ å°æ•°ã® ãŸã—ã–ã‚“ãƒ»ã²ãã–ã‚“ã‚’ ã‚Œã‚“ã—ã‚…ã†ã€‚ãƒ¬ã‚¸éŸ³ãƒ»ãƒ“ãƒ¼ãƒ—éŸ³ã¤ãã€10ãƒ©ã‚¦ãƒ³ãƒ‰ã€ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã€‚" />
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSBGNQTYRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YSBGNQTYRZ');
  </script>
  
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&display=swap" rel="stylesheet" />
  <style>
    :root{--bg1:#cfd9df;--bg2:#e2ebf0;--deep:#2d3436;--green:#2ecc71;--pink:#ff6b6b;--blue:#74b9ff}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Nunito',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));display:flex;align-items:center;justify-content:center;padding:12px}
    .app{width:100%;max-width:1040px;background:#fff;border-radius:20px;box-shadow:0 22px 44px rgba(0,0,0,.12);padding:14px;overflow:hidden}
    .title{text-align:center;font-size:1.6rem;color:#ff6b6b;font-weight:800}
    .equation{text-align:center;font-size:2rem;font-weight:800;color:var(--deep)}
    .hud{display:flex;gap:8px;justify-content:center;margin:8px 0;flex-wrap:wrap}
    .pill{background:linear-gradient(45deg,#74b9ff,#6c5ce7);color:#fff;padding:6px 12px;border-radius:999px;font-weight:800}
    .store{display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-top:8px}
    .shelf{background:#f7fbff;border:4px solid #b4d4ff;border-radius:16px;padding:10px;min-height:280px}
    .items{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .item{background:#ffffff;border:3px solid #e8eef9;border-radius:12px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:grab;touch-action:none}
    .item:active{cursor:grabbing}
    .price{background:linear-gradient(45deg,#2bcbba,#00b894);color:#fff;padding:4px 8px;border-radius:10px;font-weight:800}
    .coupon{background:linear-gradient(45deg,#ff7675,#e17055)}
    .cart{background:#fff;border:4px solid #ffd166;border-radius:16px;padding:10px;min-height:280px;position:relative}
    .cart-title{font-weight:800;margin-bottom:6px}
    .cart-line{display:flex;justify-content:space-between;border-bottom:1px dashed #eee;padding:4px 0}
    .total{font-size:1.4rem;font-weight:800;text-align:right;margin-top:8px}
    .controls{display:flex;gap:10px;justify-content:center;margin-top:8px;flex-wrap:wrap}
    .btn{background:linear-gradient(45deg,#ff6b6b,#e84393);color:#fff;border:none;padding:12px 18px;font-size:1.1rem;font-weight:800;border-radius:16px}
    .btn.secondary{background:linear-gradient(45deg,#00b894,#00cec9)}
    .feedback{text-align:center;min-height:36px;font-size:1.2rem;font-weight:800;margin-top:6px}
    .correct{color:#2ecc71}.incorrect{color:#e17055}
    @media (max-width:900px){.store{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="å°æ•°ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³">
    <div class="title">ğŸ›’ å°æ•°ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</div>
    <div class="equation" id="equation">3.50 + 2.75 = ?</div>
    <div class="hud">
      <div class="pill" id="qinfo">ãƒ©ã‚¦ãƒ³ãƒ‰: 1 / 10</div>
      <div class="pill" id="score">ã‚¹ã‚³ã‚¢: 0</div>
      <div class="pill" id="budget">ã®ã“ã‚Š: Â¥20.00</div>
      <div class="pill" id="level">ãƒ¬ãƒ™ãƒ«: 1</div>
      <div class="pill" id="repeat">ãƒªãƒ”ãƒ¼ãƒˆ: OFF</div>
    </div>
    <div class="store">
      <div class="shelf">
        <div class="items" id="items"></div>
      </div>
      <div class="cart" id="cart">
        <div class="cart-title">ğŸ§º ã‚«ãƒ¼ãƒˆ</div>
        <div id="cartLines"></div>
        <div class="total" id="cartTotal">Â¥0.00</div>
      </div>
    </div>
    <div class="controls">
      <button class="btn" id="checkBtn">ã“ãŸãˆã‚‹ï¼</button>
      <button class="btn secondary" id="nextBtn">ã¤ãã¸</button>
      <button class="btn secondary" id="restartBtn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button class="btn secondary" id="repeatBtn">ãƒªãƒ”ãƒ¼ãƒˆ: OFF</button>
    </div>
    <div class="feedback" id="feedback"></div>
  </div>

  <script>
    // çŠ¶æ…‹
    let idx=0,total=10,score=0,level=1,repeat=false;
    let budget=20.00; // äºˆç®—
    let a=3.50,b=2.75,coupon=0.00,op='+'; // op: '+' or '-'
    let audioCtx=null;

    const itemsEl=document.getElementById('items');
    const cartEl=document.getElementById('cartLines');
    const cartTotalEl=document.getElementById('cartTotal');
    const feedback=document.getElementById('feedback');

    const PRODUCTS=[
      { name:'ğŸ ã‚Šã‚“ã”', base:0.75 },
      { name:'ğŸ¥ ãƒ‘ãƒ³', base:1.20 },
      { name:'ğŸ¥› ãƒŸãƒ«ã‚¯', base:1.35 },
      { name:'ğŸ« ãƒãƒ§ã‚³', base:0.95 },
      { name:'ğŸ“— ãƒãƒ¼ãƒˆ', base:1.80 },
      { name:'ğŸ§¸ ãƒˆã‚¤', base:2.40 }
    ];

    init();
    function init(){
      bind();
      start();
      const warm = () => { if(!audioCtx){ try{ audioCtx=new (window.AudioContext||window.webkitAudioContext)(); }catch(e){} } window.removeEventListener('pointerdown', warm); };
      window.addEventListener('pointerdown', warm, { once:true });
    }

    function bind(){
      document.getElementById('checkBtn').addEventListener('click', check);
      document.getElementById('nextBtn').addEventListener('click', nextRound);
      document.getElementById('restartBtn').addEventListener('click', start);
      document.getElementById('repeatBtn').addEventListener('click', ()=>{ repeat=!repeat; document.getElementById('repeat').textContent=`ãƒªãƒ”ãƒ¼ãƒˆ: ${repeat?'ON':'OFF'}`; document.getElementById('repeatBtn').textContent=`ãƒªãƒ”ãƒ¼ãƒˆ: ${repeat?'ON':'OFF'}`; });
    }

    function start(){ idx=0; score=0; level=1; budget=20.00; nextRound(true); }

    function nextRound(reset){
      if(!reset && idx>=total){
        feedback.className='feedback correct';
        feedback.textContent=`ğŸ‰ ãŠã‚ã‚Šï¼ ã‚¹ã‚³ã‚¢: ${score} / ${total}ï¼ˆã®ã“ã‚Šäºˆç®—: Â¥${fmt(budget)}ï¼‰`;
        if(repeat){ setTimeout(start, 1000); }
        return;
      }
      generateProblem();
      renderStore();
      renderCart([]);
      idx++;
      updateHUD();
    }

    function generateProblem(){
      // å°æ•°ç¬¬2ä½ã¾ã§ã®ãƒ©ãƒ³ãƒ€ãƒ é‡‘é¡
      a = rndMoney(rand(50,250)/100); // 0.50 - 2.50
      b = rndMoney(rand(50,250)/100);
      op = Math.random()<0.6 ? '+' : '-';
      if(op==='-' && a<=b){ const tmp=a; a=b; b=tmp; } // çµæœãŒè² ã«ãªã‚‰ãªã„
      // ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹ã¨ä¾¡æ ¼å¸¯ã‚¢ãƒƒãƒ—
      const boost = (Math.floor(score/3))*0.25;
      a = rndMoney(a+boost);
      b = rndMoney(b+boost);
      coupon = op==='-' ? b : 0.00;
      document.getElementById('equation').textContent = `${fmt(a)} ${op} ${fmt(b)} = ?`;
    }

    function renderStore(){
      itemsEl.innerHTML='';
      // å•é¡Œã«åˆã‚ã›ãŸç‰¹è¨­ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆa, b, couponï¼‰
      const specials = [
        { name:'ã‚¹ãƒšã‚·ãƒ£ãƒ«A', price:a, emoji:'ğŸ›ï¸' },
        { name: op==='+' ? 'ã‚¹ãƒšã‚·ãƒ£ãƒ«B' : 'ã‚¯ãƒ¼ãƒãƒ³', price: op==='+' ? b : -b, emoji: op==='+' ? 'ğŸ§º' : 'ğŸŸï¸' },
      ];
      const pool = [...specials, ...PRODUCTS.map(p=>({ name:p.name, price:rndMoney(p.base + (rand(-25,25)/100)) }))];
      pool.forEach(prod=>itemsEl.appendChild(createItem(prod)));
    }

    function createItem(prod){
      const el = document.createElement('div'); el.className='item'; el.draggable=true; el.dataset.price=prod.price.toFixed(2);
      el.innerHTML = `<div>${prod.emoji||''} ${prod.name||''}</div><div class="price ${prod.price<0?'coupon':''}">Â¥${fmt(prod.price)}</div>`;
      el.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', el.dataset.price); });
      // ã‚¿ãƒƒãƒå‘ã‘: ã‚¿ãƒƒãƒ—ã§è¿½åŠ 
      el.addEventListener('click', ()=>{ addToCart({ name: prod.name, price: prod.price }); });
      return el;
    }

    function renderCart(lines){
      cartEl.innerHTML='';
      let total=0;
      lines.forEach(line=>{
        const row=document.createElement('div'); row.className='cart-line';
        row.innerHTML=`<span>${line.name}</span><span>Â¥${fmt(line.price)}</span>`;
        cartEl.appendChild(row); total += line.price;
      });
      cartTotalEl.textContent = `Â¥${fmt(total)}`;
      cartEl.dataset.total = total.toFixed(2);
    }

    const cartLines=[];
    // ãƒ‰ãƒ­ãƒƒãƒ—å…ˆ
    const cart = document.getElementById('cart');
    cart.addEventListener('dragover', e=>e.preventDefault());
    cart.addEventListener('drop', e=>{
      e.preventDefault(); const price=parseFloat(e.dataTransfer.getData('text/plain'))||0; const name='ã‚¢ã‚¤ãƒ†ãƒ '; addToCart({ name, price });
    });

    function addToCart(line){ cartLines.push(line); renderCart(cartLines); playClick(); }

    function check(){
      const total = parseFloat(cartEl.dataset.total||'0');
      const expected = op==='+' ? rndMoney(a+b) : rndMoney(a-b);
      if(eq(total, expected)){
        score++; cashRegister();
        // äºˆç®—ã‹ã‚‰æ¶ˆè²»ï¼ˆå‰²å¼•ã‚‚åæ˜ ï¼‰
        budget = rndMoney(Math.max(0, budget - expected));
        feedback.className='feedback correct';
        feedback.textContent='âœ… ã›ã„ã‹ã„ï¼ ã—ã‚‡ã†ã™ã†ç‚¹ã‚’ ãã‚ãˆã¦ ãŸã—ã²ã ã§ããŸã­';
        nextDelay();
      } else {
        beep();
        feedback.className='feedback incorrect';
        feedback.textContent='ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã—ã‚‡ã†ã™ã†ç‚¹ã‚’ ãã‚ãˆã¦ ã‘ã„ã•ã‚“ã—ã¦ã¿ã‚ˆã†';
      }
      updateHUD();
    }

    function nextDelay(){ setTimeout(()=>nextRound(), 900); }

    function updateHUD(){
      document.getElementById('qinfo').textContent=`ãƒ©ã‚¦ãƒ³ãƒ‰: ${Math.min(idx+0,total)} / ${total}`;
      document.getElementById('score').textContent=`ã‚¹ã‚³ã‚¢: ${score}`;
      document.getElementById('level').textContent=`ãƒ¬ãƒ™ãƒ«: ${1 + Math.floor(score/3)}`;
      document.getElementById('budget').textContent=`ã®ã“ã‚Š: Â¥${fmt(budget)}`;
    }

    // éŸ³
    function cashRegister(){ playTone(880,.08,'triangle',.07); setTimeout(()=>playTone(1175,.1,'triangle',.07),90); }
    function beep(){ playTone(220,.2,'sawtooth',.04); }
    function playClick(){ playTone(600,.05,'sine',.03); }
    function playTone(freq=880,dur=.18,type='sine',gain=.06){ if(!audioCtx) return; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=gain; o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+dur); }

    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    function fmt(n){ return (Math.round(n*100)/100).toFixed(2); }
    function rndMoney(n){ return Math.round(n*100)/100; }
    function eq(a,b){ return Math.abs(a-b) < 0.005; }
    function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
  </script>
</body>
</html>


