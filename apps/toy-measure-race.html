<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>„Åä„ÇÇ„Å°„ÇÉÊ∏¨ÂÆö„É¨„Éº„Çπ</title>
  <meta name="description" content="„Éà„É©„ÉÉ„ÇØ„ÅÆÈï∑„Åï„Çí „ÅØ„Åã„Å£„Å¶ „Åü„Åó„Åñ„Çì„ÄÇ„ÅØ„Åü„Åå „ÇÜ„Çå„Å¶„Ç¥„Éº„É´ÔºÅ „Çø„Ç§„Éû„Éº„Å§„Åç„ÄÇ" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&display=swap" rel="stylesheet" />
  <style>
    :root{--bg1:#d4fc79;--bg2:#96e6a1;--deep:#2d3436}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Nunito',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));display:flex;align-items:center;justify-content:center;padding:12px}
    .app{width:100%;max-width:980px;background:#fff;border-radius:20px;box-shadow:0 22px 44px rgba(0,0,0,.12);padding:14px}
    .title{text-align:center;font-size:1.6rem;color:#ff6b6b;font-weight:800}
    .hud{display:flex;gap:8px;justify-content:center;margin:6px 0;flex-wrap:wrap}
    .pill{background:linear-gradient(45deg,#74b9ff,#6c5ce7);color:#fff;padding:6px 12px;border-radius:999px;font-weight:800}
    .track-wrap{background:#eef7ff;border:4px solid #b4d4ff;border-radius:16px;padding:8px}
    canvas{width:100%;height:260px;display:block}
    .equation-row{display:flex;gap:8px;justify-content:center;align-items:center;margin-top:8px;flex-wrap:wrap}
    .equation{font-size:1.8rem;font-weight:800}
    .answer{font-size:1.6rem;font-weight:800;width:120px;text-align:center;border:4px solid #74b9ff;border-radius:12px;padding:6px 10px}
    .controls{display:flex;gap:10px;justify-content:center;margin-top:8px;flex-wrap:wrap}
    .btn{background:linear-gradient(45deg,#ff6b6b,#e84393);color:#fff;border:none;padding:12px 18px;font-size:1.1rem;font-weight:800;border-radius:16px}
    .feedback{text-align:center;min-height:36px;font-weight:800}
    .flag{position:absolute;right:14px;top:14px;font-size:28px;animation:wave .9s ease-in-out infinite alternate}
    @keyframes wave{to{transform:rotate(12deg)}}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="„Åä„ÇÇ„Å°„ÇÉÊ∏¨ÂÆö„É¨„Éº„Çπ">
    <div class="title">üèÅ „Åä„ÇÇ„Å°„ÇÉÊ∏¨ÂÆö„É¨„Éº„Çπ</div>
    <div class="hud"><div class="pill" id="qinfo">„ÇÇ„Çì„Å†„ÅÑ: 1 / 10</div><div class="pill" id="score">„Çπ„Ç≥„Ç¢: 0</div><div class="pill" id="time">„Çø„Ç§„Éû„Éº: 15</div></div>
    <div class="track-wrap" style="position:relative"><span class="flag">üö©</span><canvas id="cv"></canvas></div>
    <div class="equation-row"><div class="equation" id="eq">„Ç≥„Éº„Çπ 4 cm + 3 cm = ?</div><input id="ans" class="answer" inputmode="numeric" pattern="[0-9]*" placeholder="?" maxlength="2" /></div>
    <div class="controls">
      <button class="btn" id="checkBtn">„Åì„Åü„Åà„ÇãÔºÅ</button>
      <button class="btn" id="nextBtn">„Å§„Åé„Å∏</button>
    </div>
    <div class="feedback" id="fb"></div>
  </div>

  <script>
    const cv=document.getElementById('cv'), ctx=cv.getContext('2d'); const fb=document.getElementById('fb'); const ans=document.getElementById('ans');
    let a=4,b=3,idx=0,total=10,score=0,time=15,timer=null;
    function fit(){ const r=cv.getBoundingClientRect(); const s=window.devicePixelRatio||1; const w=Math.floor(r.width*s), h=Math.floor(260*s); if(cv.width!==w||cv.height!==h){ cv.width=w; cv.height=h; } }
    function draw(){ ctx.clearRect(0,0,cv.width,cv.height); // track
      ctx.fillStyle='#a3d9a5'; ctx.fillRect(20,cv.height-80,cv.width-40,40); // ruler
      ctx.fillStyle='#2d3436'; for(let i=0;i<=10;i++){ const x=40+i*(cv.width-80)/10; ctx.fillRect(x,cv.height-90,2,20); ctx.fillText(i+'cm', x-8, cv.height-96); }
      // segments a and b
      const unit=(cv.width-80)/10; ctx.fillStyle='#74b9ff'; ctx.fillRect(40,cv.height-120,a*unit,20); ctx.fillStyle='#ff6b6b'; ctx.fillRect(40+a*unit,cv.height-120,b*unit,20);
      // cars
      ctx.font='16px Nunito'; ctx.fillStyle='#074'; ctx.fillText('üöó', 40+a*unit-14, cv.height-125); ctx.fillText('üöô', 40+(a+b)*unit-14, cv.height-125);
    }
    function gen(){ a=rand(1,10); b=rand(1,10); while(a+b>19){ a=rand(1,10); b=rand(1,10);} document.getElementById('eq').textContent=`„Ç≥„Éº„Çπ ${a} cm + ${b} cm = ?`; ans.value=''; time=15; tick(); if(timer){ clearInterval(timer);} timer=setInterval(()=>{ time=Math.max(0,time-1); tick(); if(time===0){ clearInterval(timer); fb.textContent='‚åõ „Åò„Åã„Çì„Åé„ÇåÔºÅ'; } },1000); }
    function tick(){ document.getElementById('time').textContent='„Çø„Ç§„Éû„Éº: '+time; }
    function check(){ const v=parseInt(ans.value.replace(/[^0-9]/g,''),10); if(Number.isNaN(v)){ fb.textContent='„Åô„ÅÜ„Åò„Çí „ÅÑ„Çå„Å¶„Å≠'; return;} if(v===a+b){ score++; fb.textContent='üèÅ „Åõ„ÅÑ„Åã„ÅÑÔºÅ'; setTimeout(next,700);} else { fb.textContent='„Å°„Åå„ÅÜ„ÇàÔºÅ „ÇÇ„ÅÜ„ÅÑ„Å°„Å©'; } document.getElementById('score').textContent='„Çπ„Ç≥„Ç¢: '+score; }
    function next(){ if(idx>=total-1){ fb.textContent=`üéâ „Åä„Çè„ÇäÔºÅ „Çπ„Ç≥„Ç¢: ${score} / ${total}`; return;} idx++; document.getElementById('qinfo').textContent=`„ÇÇ„Çì„Å†„ÅÑ: ${idx+1} / ${total}`; gen(); draw(); }
    function start(){ idx=0; score=0; document.getElementById('qinfo').textContent=`„ÇÇ„Çì„Å†„ÅÑ: 1 / ${total}`; gen(); fit(); draw(); }
    function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    window.addEventListener('resize', ()=>{ fit(); draw(); });
    document.getElementById('checkBtn').addEventListener('click', check); document.getElementById('nextBtn').addEventListener('click', next);
    ans.addEventListener('keypress',e=>{ if(e.key==='Enter') check(); }); ans.addEventListener('input',e=>{ let v=e.target.value; v=v.replace(/[Ôºê-Ôºô]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xFEE0)); v=v.replace(/[^0-9]/g,''); e.target.value=v.slice(0,2); });
    start();
  </script>
</body>
</html>


