<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åü„Åó„Åñ„Çì „Çå„Çì„Åó„ÇÖ„ÅÜ</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSBGNQTYRZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-YSBGNQTYRZ');
    </script>
    
    <!-- Áµ±‰∏Ä„Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É† -->
    <style>
        /* Áµ±‰∏Ä„Éá„Ç∂„Ç§„É≥„Ç∑„Çπ„ÉÜ„É†„ÇíÁõ¥Êé•Âüã„ÇÅËæº„Åø */
        :root {
          --primary-blue: #4fc3f7;
          --primary-green: #66bb6a;
          --primary-yellow: #ffd166;
          --primary-pink: #ff6b9d;
          --success: #28a745;
          --error: #dc3545;
          --text-primary: #2c3e50;
          --text-secondary: #546e7a;
          --white: #ffffff;
          --gradient-blue: linear-gradient(45deg, var(--primary-blue), #29b6f6);
          --gradient-green: linear-gradient(45deg, var(--primary-green), #4caf50);
          --gradient-yellow: linear-gradient(45deg, var(--primary-yellow), #ffb300);
          --gradient-pink: linear-gradient(45deg, var(--primary-pink), #e91e63);
          --font-family: 'Comic Sans MS', cursive, sans-serif;
          --text-title: 2.2rem;
          --text-problem: 3.5rem;
          --space-3: 0.75rem;
          --space-4: 1rem;
          --space-5: 1.25rem;
          --space-6: 1.5rem;
          --space-8: 2rem;
          --space-10: 2.5rem;
          --radius-lg: 16px;
          --radius-xl: 20px;
          --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
          --shadow-lg: 0 6px 20px rgba(0, 0, 0, 0.1);
          --transition-base: 0.3s ease;
          --touch-min: 60px;
          --input-width-md: 160px;
          --input-height-md: 80px;
        }
        
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        
        body {
          font-family: var(--font-family);
          color: var(--text-primary);
          line-height: 1.6;
          background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 50%, #fff3e0 100%);
          min-height: 100vh;
        }
        
        .page-wrapper {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: var(--space-4);
          overflow: hidden;
        }
        
        .container {
          background: var(--white);
          border-radius: var(--radius-xl);
          padding: var(--space-8);
          box-shadow: var(--shadow-lg);
          text-align: center;
          max-width: 500px;
          width: 100%;
          position: relative;
          overflow: hidden;
        }
        
        .app-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: var(--space-6);
          position: relative;
          z-index: 10;
        }
        
        .app-title {
          font-size: var(--text-title);
          font-weight: 800;
          color: var(--text-primary);
          text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
        }
        
        .back-btn {
          background: linear-gradient(45deg, var(--text-secondary), #607d8b);
          color: var(--white);
          border: none;
          padding: var(--space-3) var(--space-5);
          border-radius: var(--radius-lg);
          font-size: 1rem;
          font-weight: 700;
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: var(--shadow-md);
          min-height: var(--touch-min);
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .back-btn:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-lg);
        }
        
        .score {
          display: flex;
          justify-content: center;
          gap: var(--space-4);
          margin-bottom: var(--space-6);
          position: relative;
          z-index: 10;
        }
        
        .score-item {
          background: var(--gradient-blue);
          color: var(--white);
          padding: var(--space-3) var(--space-5);
          border-radius: var(--radius-lg);
          font-weight: 700;
          font-size: 1rem;
          box-shadow: 0 4px 12px rgba(79, 195, 247, 0.3);
        }
        
        .difficulty-selector {
          margin-bottom: var(--space-6);
          position: relative;
          z-index: 10;
        }
        
        .difficulty-label {
          font-size: 1.25rem;
          font-weight: 700;
          color: var(--text-primary);
          margin-bottom: var(--space-3);
          display: block;
        }
        
        .difficulty-buttons {
          display: flex;
          justify-content: center;
          gap: var(--space-3);
          flex-wrap: wrap;
        }
        
        .difficulty-btn {
          background: var(--gradient-pink);
          color: var(--white);
          border: none;
          padding: var(--space-3) var(--space-5);
          font-size: 1rem;
          font-weight: 600;
          border-radius: var(--radius-lg);
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
          min-height: var(--touch-min);
        }
        
        .difficulty-btn.active {
          background: var(--gradient-yellow);
          box-shadow: 0 4px 12px rgba(255, 179, 0, 0.4);
        }
        
        .difficulty-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(233, 30, 99, 0.4);
        }
        
        .problem-area {
          border-radius: var(--radius-xl);
          padding: var(--space-10) var(--space-6);
          margin: var(--space-6) 0;
          position: relative;
          z-index: 10;
          box-shadow: var(--shadow-lg);
        }
        
        .problem {
          font-size: var(--text-problem);
          font-weight: 700;
          color: var(--text-primary);
          margin-bottom: var(--space-8);
          text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
          letter-spacing: 4px;
          font-family: 'Nunito', var(--font-family);
        }
        
        .input-area {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: var(--space-5);
          margin-bottom: var(--space-8);
        }
        
        .equals {
          font-size: var(--text-problem);
          font-weight: 700;
          color: var(--text-primary);
          font-family: 'Nunito', var(--font-family);
        }
        
        .answer-input {
          font-size: var(--text-problem);
          font-weight: 700;
          text-align: center;
          border: 4px solid var(--primary-blue);
          border-radius: var(--radius-xl);
          padding: var(--space-5) var(--space-6);
          width: var(--input-width-md);
          background: var(--white);
          color: var(--text-primary);
          box-shadow: var(--shadow-lg);
          transition: all var(--transition-base);
          font-family: 'Nunito', var(--font-family);
          min-height: var(--input-height-md);
        }
        
        .btn {
          border: none;
          border-radius: var(--radius-xl);
          font-weight: 700;
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: var(--shadow-md);
          display: inline-flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          font-family: var(--font-family);
          min-height: var(--touch-min);
        }
        
        .btn:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-lg);
        }
        
        .btn:active {
          transform: translateY(-1px);
        }
        
        .btn-primary {
          background: var(--gradient-green);
          color: var(--white);
          padding: var(--space-5) var(--space-10);
          font-size: 1.5rem;
          box-shadow: 0 6px 16px rgba(76, 175, 80, 0.3);
        }
        
        .btn-secondary {
          background: var(--gradient-blue);
          color: var(--white);
          padding: var(--space-4) var(--space-8);
          font-size: 1.25rem;
          box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        
        .feedback {
          margin-top: var(--space-5);
          font-size: 1.5rem;
          font-weight: 700;
          min-height: 50px;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          z-index: 10;
          flex-wrap: wrap;
          gap: var(--space-4);
        }
        
        .feedback.correct {
          color: var(--success);
          animation: bounce 0.6s ease;
        }
        
        .feedback.incorrect {
          color: var(--error);
          animation: shake 0.6s ease;
        }
        
        @keyframes bounce {
          0%, 20%, 60%, 100% { transform: translateY(0); }
          40% { transform: translateY(-20px); }
          80% { transform: translateY(-10px); }
        }
        
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
          20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        
        .stars {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          z-index: 1;
        }
        
        .star {
          position: absolute;
          color: var(--primary-yellow);
          font-size: 1.5rem;
          animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
          0%, 100% { opacity: 0.3; transform: scale(1); }
          50% { opacity: 1; transform: scale(1.3); }
        }
        
        .hidden { display: none; }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ */
        @media (max-width: 600px) {
          .container {
            padding: var(--space-6) var(--space-4);
            max-width: 100%;
          }
          
          .app-title {
            font-size: 1.8rem;
            position: static;
            transform: none;
            margin-bottom: var(--space-4);
          }
          
          .app-header {
            flex-direction: column;
            gap: var(--space-4);
          }
          
          .problem {
            font-size: 3rem;
          }
          
          .answer-input {
            font-size: 3rem;
            width: 140px;
            padding: var(--space-4) var(--space-5);
          }
          
          .equals {
            font-size: 3rem;
          }
          
          .score {
            flex-direction: column;
            gap: 8px;
          }
          
          .difficulty-buttons {
            flex-direction: column;
            align-items: center;
          }
          
          .feedback {
            font-size: 1.125rem;
            flex-direction: column;
          }
        }
        
        @media (max-width: 400px) {
          .container {
            padding: var(--space-5) var(--space-3);
          }
          
          .app-title {
            font-size: 1.6rem;
          }
          
          .problem {
            font-size: 2.5rem;
          }
          
          .answer-input {
            font-size: 2.5rem;
            width: 120px;
          }
          
          .equals {
            font-size: 2.5rem;
          }
          
          .btn-primary {
            font-size: 1.125rem;
            padding: var(--space-4) var(--space-6);
          }
        }
    </style>
    
    <style>
        /* „Ç¢„Éó„É™Âõ∫Êúâ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .problem-area {
            background: linear-gradient(45deg, #e8f5e8, #c8e6c8);
        }
        
        .answer-input:focus {
            border-color: var(--primary-green);
            box-shadow: 0 8px 24px rgba(102, 187, 106, 0.4);
        }
        
        /* ÊàêÂäüÊôÇ„ÅÆËøΩÂä†„Ç®„Éï„Çß„ÇØ„Éà */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }
        
        .confetti {
            position: absolute;
            width: 8px;
            height: 12px;
            opacity: 0.9;
            animation: confetti-fall 1.5s ease-out forwards;
            border-radius: 2px;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(120vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Âä±„Åæ„Åó„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆËøΩÂä†„Çπ„Çø„Ç§„É´ */
        .encouragement-box {
            background: var(--gradient-green);
            color: var(--white);
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-lg);
            margin: var(--space-4) 0;
            font-size: var(--text-lg);
            font-weight: var(--font-bold);
            box-shadow: var(--shadow-md);
            animation: pulse 1s ease infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="container">
            <div class="stars" id="stars"></div>
            <div class="confetti-container" id="confetti"></div>
            
            <!-- Áµ±‰∏Ä„Éò„ÉÉ„ÉÄ„Éº -->
            <div class="app-header">
                <button class="back-btn" onclick="goBack()">‚Üê „ÇÇ„Å©„Çã</button>
                <h1 class="app-title">üåü „Åü„Åó„Åñ„Çì „Çå„Çì„Åó„ÇÖ„ÅÜ</h1>
            </div>
            
            <!-- „Çπ„Ç≥„Ç¢Ë°®Á§∫ -->
            <div class="score">
                <div class="score-item">
                    „Åõ„ÅÑ„Åã„ÅÑ: <span id="correct-count">0</span>
                </div>
                <div class="score-item">
                    „ÇÇ„Çì„Å†„ÅÑ: <span id="total-count">0</span>
                </div>
                <div class="score-item">
                    „Çå„Çì„Åû„Åè: <span id="streak-count">0</span>
                </div>
            </div>
            
            <!-- Èõ£ÊòìÂ∫¶ÈÅ∏Êäû -->
            <div class="difficulty-selector">
                <label class="difficulty-label">„ÇÄ„Åö„Åã„Åó„Åï„Çí „Åà„Çâ„Çì„Åß„Å≠ÔºÅ</label>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn active" onclick="setDifficulty('easy')" data-level="easy">
                        „Åã„Çì„Åü„Çì (10„Åæ„Åß)
                    </button>
                    <button class="difficulty-btn" onclick="setDifficulty('medium')" data-level="medium">
                        „Åµ„Å§„ÅÜ (20„Åæ„Åß)
                    </button>
                    <button class="difficulty-btn" onclick="setDifficulty('hard')" data-level="hard">
                        „ÇÄ„Åö„Åã„Åó„ÅÑ (100„Åæ„Åß)
                    </button>
                </div>
            </div>
            
            <!-- ÂïèÈ°å„Ç®„É™„Ç¢ -->
            <div class="problem-area">
                <div class="problem" id="problem">5 + 3</div>
                <div class="input-area">
                    <span class="equals">=</span>
                    <input type="text" class="answer-input" id="answer" placeholder="?" maxlength="3" autocomplete="off">
                </div>
                <button class="btn btn-primary" id="submit-btn" onclick="checkAnswer()">„Åì„Åü„Åà„ÇãÔºÅ</button>
            </div>
            
            <!-- „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Ç®„É™„Ç¢ -->
            <div class="feedback" id="feedback"></div>
            
            <!-- Âä±„Åæ„Åó„É°„ÉÉ„Çª„Éº„Ç∏ÔºàÈÄ£Á∂öÊ≠£Ëß£ÊôÇÔºâ -->
            <div class="encouragement-box hidden" id="encouragement">
                üî• „Åô„Åî„ÅÑÔºÅ„Çå„Çì„Åû„Åè „Åõ„ÅÑ„Åã„ÅÑÔºÅ
            </div>
        </div>
    </div>

    <script>
        let currentProblem = {};
        let correctCount = 0;
        let totalCount = 0;
        let streakCount = 0;
        let isAnswered = false;
        let difficulty = 'easy';
        let audioContext = null;

        const encouragements = [
            "üéâ „Åô„Åî„ÅÑÔºÅ„Åõ„ÅÑ„Åã„ÅÑÔºÅ",
            "‚ú® „ÇÑ„Å£„Åü„Å≠ÔºÅ",
            "üåü „Åã„Çì„Å∫„ÅçÔºÅ",
            "üéä „Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ",
            "üí´ „Åô„Å∞„Çâ„Åó„ÅÑÔºÅ",
            "üèÜ „Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ",
            "üéà „Å†„ÅÑ„Åõ„ÅÑ„Åã„ÅÑÔºÅ",
            "‚≠ê „Åô„Å¶„ÅçÔºÅ",
            "üåà „Åä„Åó„ÇÉ„ÇåÔºÅ"
        ];

        const tryAgainMessages = [
            "üòä „ÇÇ„ÅÜ„ÅÑ„Å°„Å© „Åå„Çì„Å∞„Å£„Å¶ÔºÅ",
            "ü§î „Å°„Åå„ÅÜ„Çà„ÄÇ„ÇÇ„ÅÜ„ÅÑ„Å°„Å©ÔºÅ",
            "üí™ „ÅÇ„Å®„Åô„Åì„ÅóÔºÅ„Åå„Çì„Å∞„Å£„Å¶ÔºÅ",
            "üåà „Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂ÔºÅ„ÇÇ„ÅÜ„ÅÑ„Å°„Å©ÔºÅ",
            "üéØ „Åä„Åó„ÅÑÔºÅ„ÇÇ„ÅÜ„ÅÑ„Å°„Å©ÔºÅ",
            "ü§ó „ÇÇ„ÅÜ‰∏ÄÂõû „ÇÑ„Å£„Å¶„Åø„Çà„ÅÜÔºÅ"
        ];

        const streakMessages = [
            "üî• „Çå„Çì„Åû„Åè „Åõ„ÅÑ„Åã„ÅÑÔºÅ",
            "‚ö° „Å°„Çá„ÅÜ„Åó „ÅÑ„ÅÑ„Å≠ÔºÅ",
            "üöÄ „Åô„Åî„ÅÑ „Å°„Åã„ÇâÔºÅ",
            "üåü „Åç„Åø„ÅØ „Å¶„Çì„Åï„ÅÑÔºÅ"
        ];

        // Èü≥ÈüøÂàùÊúüÂåñ
        function initAudio() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
        }

        // Áµ±‰∏Ä„Åï„Çå„ÅüÊàêÂäüÈü≥„ÇíÂÜçÁîü
        function playSuccessSound() {
            if (!audioContext) return;
            
            const frequencies = [523, 659, 784]; // „Éâ„Éü„ÇΩ
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'triangle';
                    
                    gainNode.gain.value = 0.1;
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                }, index * 100);
            });
        }

        // Áµ±‰∏Ä„Åï„Çå„Åü„Ç®„É©„ÉºÈü≥„ÇíÂÜçÁîü
        function playErrorSound() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.frequency.value = 200;
            oscillator.type = 'sawtooth';
            
            gainNode.gain.value = 0.05;
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // Áµ±‰∏Ä„Åï„Çå„ÅüÊàª„Çã„Éú„Çø„É≥
        function goBack() {
            if (confirm('„É°„Éã„É•„Éº„Å´Êàª„Çä„Åæ„Åô„ÅãÔºü')) {
                window.history.back();
            }
        }

        // ÂÖ®ËßíÊï∞Â≠ó„ÇíÂçäËßíÊï∞Â≠ó„Å´Â§âÊèõ
        function convertToHalfWidth(str) {
            return str.replace(/[Ôºê-Ôºô]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        }

        // Êï∞Â≠ó‰ª•Â§ñ„ÅÆÊñáÂ≠ó„ÇíÈô§Âéª
        function extractNumbers(str) {
            return str.replace(/[^0-9]/g, '');
        }

        // Èõ£ÊòìÂ∫¶Ë®≠ÂÆö
        function setDifficulty(level) {
            difficulty = level;
            
            // „Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-level="${level}"]`).classList.add('active');
            
            generateProblem();
        }

        // ÂïèÈ°åÁîüÊàê
        function generateProblem() {
            let num1, num2;
            
            switch(difficulty) {
                case 'easy':
                    num1 = Math.floor(Math.random() * 10) + 1; // 1-10
                    num2 = Math.floor(Math.random() * 10) + 1; // 1-10
                    break;
                case 'medium':
                    num1 = Math.floor(Math.random() * 20) + 1; // 1-20
                    num2 = Math.floor(Math.random() * 20) + 1; // 1-20
                    break;
                case 'hard':
                    num1 = Math.floor(Math.random() * 50) + 1; // 1-50
                    num2 = Math.floor(Math.random() * 50) + 1; // 1-50
                    break;
            }
            
            currentProblem = {
                num1: num1,
                num2: num2,
                answer: num1 + num2
            };
            
            document.getElementById('problem').textContent = `${num1} + ${num2}`;
            document.getElementById('answer').value = '';
            document.getElementById('feedback').textContent = '';
            document.getElementById('answer').focus();
            isAnswered = false;
            
            // Êó¢Â≠ò„ÅÆ„Äå„Å§„Åé„ÅÆ„ÇÇ„Çì„Å†„ÅÑ„Äç„Éú„Çø„É≥„ÇíÂâäÈô§
            const existingNextBtn = document.querySelector('.btn-secondary');
            if (existingNextBtn) {
                existingNextBtn.remove();
            }
            
            // Âä±„Åæ„Åó„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈö†„Åô
            document.getElementById('encouragement').classList.add('hidden');
        }

        // Á≠î„Åà„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        function checkAnswer() {
            if (isAnswered) return;
            
            let userInput = document.getElementById('answer').value;
            
            // ÂÖ®ËßíÊï∞Â≠ó„ÇíÂçäËßíÊï∞Â≠ó„Å´Â§âÊèõ
            userInput = convertToHalfWidth(userInput);
            
            // Êï∞Â≠ó‰ª•Â§ñ„ÅÆÊñáÂ≠ó„ÇíÈô§Âéª
            userInput = extractNumbers(userInput);
            
            const userAnswer = parseInt(userInput);
            const feedback = document.getElementById('feedback');
            
            if (isNaN(userAnswer) || userInput === '') {
                feedback.textContent = "„Åô„ÅÜ„Åò„Çí „ÅÑ„Çå„Å¶„Å≠ÔºÅ";
                feedback.className = 'feedback incorrect';
                playErrorSound();
                return;
            }
            
            totalCount++;
            document.getElementById('total-count').textContent = totalCount;
            
            if (userAnswer === currentProblem.answer) {
                correctCount++;
                streakCount++;
                document.getElementById('correct-count').textContent = correctCount;
                document.getElementById('streak-count').textContent = streakCount;
                
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                feedback.textContent = randomEncouragement;
                feedback.className = 'feedback correct';
                
                playSuccessSound();
                createStars();
                createConfetti();
                
                // ÈÄ£Á∂öÊ≠£Ëß£ÊôÇ„ÅÆÁâπÂà•„É°„ÉÉ„Çª„Éº„Ç∏
                if (streakCount >= 3 && streakCount % 3 === 0) {
                    const encouragementBox = document.getElementById('encouragement');
                    const randomStreak = streakMessages[Math.floor(Math.random() * streakMessages.length)];
                    encouragementBox.textContent = `${randomStreak} (${streakCount}„Çå„Çì„Åû„Åè)`;
                    encouragementBox.classList.remove('hidden');
                }
                
                // „Äå„Å§„Åé„ÅÆ„ÇÇ„Çì„Å†„ÅÑ„Äç„Éú„Çø„É≥„ÇíËøΩÂä†
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '„Å§„Åé„ÅÆ„ÇÇ„Çì„Å†„ÅÑ';
                nextBtn.className = 'btn btn-secondary';
                nextBtn.onclick = generateProblem;
                feedback.appendChild(nextBtn);
                
                isAnswered = true;
            } else {
                streakCount = 0; // ÈÄ£Á∂öË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà
                document.getElementById('streak-count').textContent = streakCount;
                
                const randomTryAgain = tryAgainMessages[Math.floor(Math.random() * tryAgainMessages.length)];
                feedback.textContent = randomTryAgain;
                feedback.className = 'feedback incorrect';
                
                playErrorSound();
                
                // Âä±„Åæ„Åó„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈö†„Åô
                document.getElementById('encouragement').classList.add('hidden');
                
                // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçÊåëÊà¶
                setTimeout(() => {
                    document.getElementById('answer').value = '';
                    document.getElementById('answer').focus();
                }, 1000);
            }
        }

        // Áµ±‰∏Ä„Åï„Çå„ÅüÊòü„Ç®„Éï„Çß„ÇØ„Éà„Çí‰ΩúÊàê
        function createStars() {
            const starsContainer = document.getElementById('stars');
            
            for (let i = 0; i < 12; i++) {
                const star = document.createElement('div');
                star.textContent = '‚≠ê';
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
                
                // Êòü„Çí3ÁßíÂæå„Å´ÂâäÈô§
                setTimeout(() => {
                    if (star.parentNode) {
                        star.parentNode.removeChild(star);
                    }
                }, 3000);
            }
        }

        // Á¥ôÂêπÈõ™„Ç®„Éï„Çß„ÇØ„Éà„Çí‰ΩúÊàê
        function createConfetti() {
            const confettiContainer = document.getElementById('confetti');
            const colors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#5352ed', '#ff6b81'];
            
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.3 + 's';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confettiContainer.appendChild(confetti);
                
                // Á¥ôÂêπÈõ™„Çí2ÁßíÂæå„Å´ÂâäÈô§
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 2000);
            }
        }

        // ÂÖ•ÂäõÊ¨Ñ„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.getElementById('answer').addEventListener('input', function(e) {
            let value = e.target.value;
            
            // ÂÖ®ËßíÊï∞Â≠ó„ÇíÂçäËßíÊï∞Â≠ó„Å´Â§âÊèõ
            value = convertToHalfWidth(value);
            
            // Êï∞Â≠ó‰ª•Â§ñ„ÅÆÊñáÂ≠ó„ÇíÈô§Âéª
            value = extractNumbers(value);
            
            // ÊúÄÂ§ß3Ê°Å„Åæ„ÅßÂà∂Èôê
            if (value.length > 3) {
                value = value.substring(0, 3);
            }
            
            e.target.value = value;
        });

        // Enter„Ç≠„Éº„ÅßÁ≠î„Åà„ÇíÈÄÅ‰ø°
        document.getElementById('answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // „É¶„Éº„Ç∂„ÉºÊìç‰Ωú„ÅßÈü≥Èüø„ÇíÂàùÊúüÂåñ
        document.addEventListener('click', initAudio, { once: true });
        document.addEventListener('touchstart', initAudio, { once: true });

        // ÂàùÂõûÂïèÈ°åÁîüÊàê
        generateProblem();
    </script>
</body>
</html>