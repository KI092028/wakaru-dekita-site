<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>„Éï„É´„Éº„ÉÑ„Åü„Åó„Åñ„ÇìÔºà„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„ÉóÔºâ</title>
  <meta name="description" content="Â∞èÂ≠¶Ê†°1Âπ¥ÁîüÂêë„Åë„ÅÆ„Åü„ÅóÁÆó„Ç≤„Éº„É†„ÄÇ„Éï„É´„Éº„ÉÑ„ÇíÊú®„Åã„Çâ„Åã„Åî„Å´„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„ÄÅ5+3=? „ÅÆ„Çà„ÅÜ„Å™ÂïèÈ°å„ÇíËß£„Åì„ÅÜÔºÅ„Çø„ÉÉ„ÉÅÊìç‰ΩúÂØæÂøú„ÄÅÈü≥„Å®Ëä±ÁÅ´„ÅßÊ•Ω„Åó„ÅèÂ≠¶„Åπ„Çã„Çà„ÄÇ" />
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSBGNQTYRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YSBGNQTYRZ');
  </script>
  
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg1: #a8edea;
      --bg2: #fed6e3;
      --green: #5dbb63;
      --deep-green: #3f8f45;
      --yellow: #ffd166;
      --pink: #ff6b6b;
      --blue: #74b9ff;
      --brown: #8d6e63;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Nunito', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      overflow: hidden;
    }

    .game {
      width: 100%;
      max-width: 900px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      padding: 16px;
      position: relative;
      overflow: hidden;
    }

    .header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .title {
      grid-column: 1 / -1;
      text-align: center;
      font-size: 1.6rem;
      color: var(--pink);
      font-weight: 800;
      text-shadow: 0 2px 0 rgba(0,0,0,0.06);
      margin-bottom: 6px;
    }
    .equation {
      grid-column: 1 / -1;
      text-align: center;
      font-size: 2.2rem;
      font-weight: 800;
      letter-spacing: 2px;
      color: #2d3436;
    }
    .stats {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 8px;
    }
    .pill {
      background: linear-gradient(45deg, var(--blue), #6c5ce7);
      color: #fff;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 0.95rem;
      box-shadow: 0 6px 14px rgba(108,92,231,0.3);
    }

    .play-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    .tree {
      position: relative;
      background: linear-gradient(180deg, #e9f7ef, #f7fff7);
      border-radius: 16px;
      min-height: 280px;
      padding: 12px;
      overflow: hidden;
      border: 2px solid #e6f3ea;
    }
    .tree .label {
      position: absolute;
      top: 8px;
      left: 12px;
      background: #fff;
      border: 3px solid var(--green);
      color: var(--deep-green);
      font-weight: 800;
      border-radius: 12px;
      padding: 6px 10px;
      z-index: 2;
    }
    .canopy {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 85%;
      height: 55%;
      background: radial-gradient(circle at 30% 30%, #bff199, var(--green));
      border-radius: 50% 50% 45% 45%;
      box-shadow: inset 0 -10px 0 rgba(0,0,0,0.05);
    }
    .trunk {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 90px;
      background: linear-gradient(180deg, #a1887f, var(--brown));
      border-radius: 12px;
    }

    .fruit {
      position: absolute;
      font-size: 40px;
      cursor: grab;
      user-select: none;
      touch-action: none;
      transition: transform 0.12s ease;
    }
    .fruit:active { cursor: grabbing; }
    .bounce {
      animation: bounce 0.6s ease;
    }
    @keyframes bounce {
      0%, 20%, 60%, 100% { transform: translateY(0) scale(1); }
      40% { transform: translateY(-14px) scale(1.05); }
      80% { transform: translateY(-6px) scale(1.02); }
    }

    .basket-area {
      grid-column: 1 / -1;
      margin-top: 8px;
      background: linear-gradient(180deg, #fff8e1, #fff3cd);
      border: 2px dashed #f1c40f;
      border-radius: 16px;
      padding: 12px;
      min-height: 140px;
      position: relative;
    }
    .basket-label {
      position: absolute;
      top: 8px;
      right: 12px;
      background: #fff;
      border-radius: 12px;
      border: 3px solid #f1c40f;
      padding: 6px 10px;
      font-weight: 800;
    }
    .basket {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: clamp(240px, 60%, 520px);
      height: 90px;
      background: repeating-linear-gradient(45deg, #d7a86e 0 14px, #b8874f 14px 28px);
      border-radius: 26px 26px 16px 16px;
      border: 4px solid #8d6e63;
      box-shadow: inset 0 10px 0 rgba(255,255,255,0.3);
      overflow: visible;
    }
    .basket .lip {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 105%;
      height: 20px;
      background: #8d6e63;
      border-radius: 20px;
      box-shadow: 0 6px 0 rgba(0,0,0,0.1);
    }
    .basket-fruits {
      position: absolute;
      bottom: 16px;
      left: 12px;
      right: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px 8px;
      justify-content: center;
      pointer-events: none;
      font-size: 36px;
    }

    .controls {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .btn {
      background: linear-gradient(45deg, var(--pink), #e84393);
      color: #fff;
      border: none;
      padding: 12px 18px;
      font-size: 1.2rem;
      font-weight: 800;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(232,67,147,0.3);
    }
    .btn.secondary {
      background: linear-gradient(45deg, var(--blue), #6c5ce7);
      box-shadow: 0 10px 24px rgba(108,92,231,0.3);
    }
    .btn:active { transform: translateY(1px); }

    .feedback {
      margin-top: 4px;
      min-height: 36px;
      font-size: 1.2rem;
      font-weight: 800;
      text-align: center;
    }
    .correct { color: #00b894; }
    .incorrect { color: #e17055; }

    /* Ëä±ÁÅ´Ôºà„Ç≥„É≥„Éï„Çß„ÉÉ„ÉÜ„Ç£Ôºâ */
    .confetti-container {
      pointer-events: none;
      position: absolute;
      inset: 0;
      overflow: hidden;
    }
    .confetti {
      position: absolute;
      width: 10px;
      height: 14px;
      background: red;
      opacity: 0.9;
      transform: translateY(-20px) rotate(0deg);
      animation: fall 1.2s ease-out forwards;
      border-radius: 2px;
    }
    @keyframes fall {
      to {
        transform: translateY(120vh) rotate(720deg);
        opacity: 0.2;
      }
    }

    /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
    @media (max-width: 720px) {
      .equation { font-size: 2rem; }
      .fruit { font-size: 38px; }
      .basket-fruits { font-size: 34px; }
    }
    @media (max-width: 480px) {
      .equation { font-size: 1.8rem; }
      .fruit { font-size: 36px; }
      .basket-fruits { font-size: 32px; }
    }
  </style>
</head>
<body>
  <div class="game" role="application" aria-label="„Éï„É´„Éº„ÉÑ„Åü„Åó„Åñ„Çì„Ç≤„Éº„É†">
    <div class="header">
      <div class="title">üçé „Éï„É´„Éº„ÉÑ„Åü„Åó„Åñ„Çì üçå</div>
      <div class="equation" id="equation">5 + 3 = ?</div>
      <div class="stats">
        <div class="pill" id="qno">„ÇÇ„Çì„Å†„ÅÑ: 1 / 10</div>
        <div class="pill" id="score">„Çπ„Ç≥„Ç¢: 0</div>
      </div>
    </div>

    <div class="play-area">
      <div class="tree" id="treeA" aria-label="„Çä„Çì„Åî„ÅÆÊú®">
        <div class="label">„Çä„Çì„Åî„ÅÆÊú® üçé</div>
        <div class="canopy"></div>
        <div class="trunk"></div>
      </div>
      <div class="tree" id="treeB" aria-label="„Éê„Éä„Éä„ÅÆÊú®">
        <div class="label">„Éê„Éä„Éä„ÅÆÊú® üçå</div>
        <div class="canopy"></div>
        <div class="trunk"></div>
      </div>

      <div class="basket-area" id="dropZone" aria-label="„Åã„ÅîÔºà„Éï„É´„Éº„ÉÑ„Çí„Åì„Åì„Å´„ÅÑ„Çå„Å¶„Å≠Ôºâ">
        <div class="basket-label">„Åã„Åî üß∫</div>
        <div class="basket">
          <div class="lip"></div>
          <div class="basket-fruits" id="basketFruits" aria-live="polite"></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="checkBtn">„Åì„Åü„Åà„ÇãÔºÅ</button>
      <button class="btn secondary" id="restartBtn">„Åï„ÅÑ„Åó„Çá„Åã„Çâ</button>
    </div>
    <div class="feedback" id="feedback" aria-live="polite"></div>

    <div class="confetti-container" id="confetti"></div>
  </div>

  <script>
    // „Ç≤„Éº„É†Áä∂ÊÖã
    const TOTAL_QUESTIONS = 10;
    let currentIndex = 0;
    let score = 0;
    let problem = { a: 5, b: 3, ans: 8 };
    let basketCount = 0;
    let audioCtx = null;

    const eqEl = document.getElementById('equation');
    const qnoEl = document.getElementById('qno');
    const scoreEl = document.getElementById('score');
    const feedbackEl = document.getElementById('feedback');
    const treeA = document.getElementById('treeA');
    const treeB = document.getElementById('treeB');
    const dropZone = document.getElementById('dropZone');
    const basketFruits = document.getElementById('basketFruits');
    const confetti = document.getElementById('confetti');

    // ÂàùÊúüÂåñ
    init();

    function init() {
      currentIndex = 0;
      score = 0;
      updateHUD();
      nextProblem();
      feedbackEl.textContent = '';
      setupButtons();
      setupAudioWarmup();
    }

    function setupButtons() {
      document.getElementById('checkBtn').addEventListener('click', checkAnswer);
      document.getElementById('restartBtn').addEventListener('click', init);
    }

    function setupAudioWarmup() {
      const warmup = () => {
        if (!audioCtx) {
          try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
        }
        window.removeEventListener('pointerdown', warmup);
        window.removeEventListener('touchstart', warmup);
        window.removeEventListener('mousedown', warmup);
      };
      window.addEventListener('pointerdown', warmup, { once: true });
      window.addEventListener('touchstart', warmup, { once: true });
      window.addEventListener('mousedown', warmup, { once: true });
    }

    function updateHUD() {
      qnoEl.textContent = `„ÇÇ„Çì„Å†„ÅÑ: ${Math.min(currentIndex + 1, TOTAL_QUESTIONS)} / ${TOTAL_QUESTIONS}`;
      scoreEl.textContent = `„Çπ„Ç≥„Ç¢: ${score}`;
    }

    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function makeNoCarryAddition() {
      // 1„Äú9 „ÅÆ a„ÄÅb „ÅØ 1„Äú(10-a)
      const a = randInt(1, 9);
      const b = randInt(1, 10 - a);
      return { a, b, ans: a + b };
    }

    function nextProblem() {
      if (currentIndex >= TOTAL_QUESTIONS) {
        gameOver();
        return;
      }
      // ÂïèÈ°åÁîüÊàêÔºàÁπ∞„ÇäËøî„Åó„ÅÇ„ÇäÔºâ
      problem = makeNoCarryAddition();
      basketCount = 0;
      eqEl.textContent = `${problem.a} + ${problem.b} = ?`;
      updateHUD();
      feedbackEl.textContent = '';
      clearFruits();
      spawnFruits(treeA, 'üçé', problem.a);
      spawnFruits(treeB, 'üçå', problem.b);
      basketFruits.innerHTML = '';
    }

    function gameOver() {
      feedbackEl.className = 'feedback correct';
      feedbackEl.textContent = `üéâ „Åú„Çì„Å∂ „Åß„Åç„Åü„ÇàÔºÅ „Çπ„Ç≥„Ç¢: ${score} / ${TOTAL_QUESTIONS}`;
      popConfetti(80);
    }

    function clearFruits() {
      for (const el of [treeA, treeB]) {
        // canopy/trunk/label „ÅØÊÆã„Åó„ÄÅfruit „Å†„ÅëÊ∂à„Åô
        [...el.querySelectorAll('.fruit')].forEach(n => n.remove());
      }
    }

    function spawnFruits(treeEl, emoji, count) {
      const canopy = treeEl.querySelector('.canopy');
      const rect = canopy.getBoundingClientRect();
      const treeRect = treeEl.getBoundingClientRect();
      const localLeft = rect.left - treeRect.left;
      const localTop = rect.top - treeRect.top;

      const cols = Math.min(5, Math.max(3, Math.ceil(Math.sqrt(count))));
      const rows = Math.ceil(count / cols);
      const pad = 12;
      const cellW = (rect.width - pad * 2) / cols;
      const cellH = (rect.height - pad * 2) / rows;

      for (let i = 0; i < count; i++) {
        const r = Math.floor(i / cols);
        const c = i % cols;
        const fx = localLeft + pad + c * cellW + cellW / 2 + randInt(-8, 8);
        const fy = localTop + pad + r * cellH + cellH / 2 + randInt(-8, 8);
        createFruit(treeEl, emoji, fx, fy);
      }
    }

    function createFruit(parent, emoji, x, y) {
      const el = document.createElement('div');
      el.className = 'fruit';
      el.textContent = emoji;
      parent.appendChild(el);
      position(el, x, y);
      enableDrag(el);
    }

    function position(el, x, y) {
      el.style.left = `${x - 20}px`;
      el.style.top = `${y - 20}px`;
    }

    function enableDrag(el) {
      let dragging = false;
      let offsetX = 0, offsetY = 0;
      let startX = 0, startY = 0;
      let originalParent = el.parentElement;
      let originalPos = { left: el.style.left, top: el.style.top };

      const onDown = (e) => {
        e.preventDefault();
        dragging = true;
        el.classList.add('bounce');
        const p = getPoint(e);
        const rect = el.getBoundingClientRect();
        offsetX = p.x - rect.left;
        offsetY = p.y - rect.top;
        startX = parseFloat(el.style.left) || 0;
        startY = parseFloat(el.style.top) || 0;
        el.setPointerCapture?.(e.pointerId || 1);
      };

      const onMove = (e) => {
        if (!dragging) return;
        const p = getPoint(e);
        const parentRect = el.parentElement.getBoundingClientRect();
        const nx = p.x - parentRect.left - offsetX;
        const ny = p.y - parentRect.top - offsetY;
        el.style.left = `${nx}px`;
        el.style.top = `${ny}px`;
      };

      const onUp = (e) => {
        if (!dragging) return;
        dragging = false;
        el.classList.remove('bounce');
        // „Éâ„É≠„ÉÉ„ÉóÂà§ÂÆö
        const dropped = isOverDropZone(el);
        if (dropped) {
          // „Åã„Åî„Å´ÂÖ•„Çå„Çã
          moveToBasket(el);
          playPlop();
        } else {
          // ÂÖÉ‰ΩçÁΩÆ„Å´Êàª„Åô
          el.style.left = originalPos.left;
          el.style.top = originalPos.top;
          el.classList.add('bounce');
          setTimeout(() => el.classList.remove('bounce'), 600);
        }
      };

      // Pointer EventsÔºà„Çø„ÉÉ„ÉÅ/„Éû„Ç¶„ÇπÂÖ±ÈÄöÔºâ
      el.addEventListener('pointerdown', onDown);
      window.addEventListener('pointermove', onMove);
      window.addEventListener('pointerup', onUp);
      // iOS „ÅÆ„Åø„ÅÆ„Åü„ÇÅ„Å´Âøµ„ÅÆ„Åü„ÇÅ
      el.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });
    }

    function getPoint(e) {
      if (e.touches && e.touches[0]) {
        return { x: e.touches[0].clientX, y: e.touches[0].clientY };
      }
      return { x: e.clientX, y: e.clientY };
    }

    function isOverDropZone(el) {
      const fruitRect = el.getBoundingClientRect();
      const dzRect = dropZone.getBoundingClientRect();
      const overlap = !(fruitRect.right < dzRect.left ||
                        fruitRect.left > dzRect.right ||
                        fruitRect.bottom < dzRect.top ||
                        fruitRect.top > dzRect.bottom);
      return overlap;
    }

    function moveToBasket(el) {
      // ‰ª•Âæå„Éâ„É©„ÉÉ„Ç∞‰∏çÂèØ
      el.style.pointerEvents = 'none';
      el.style.opacity = '0';
      setTimeout(() => el.remove(), 200);
      // „Åã„ÅîÂÜÖ„Å´Ë°®Á§∫
      const clone = document.createElement('span');
      clone.textContent = el.textContent;
      clone.className = 'bounce';
      basketFruits.appendChild(clone);
      basketCount++;
    }

    function checkAnswer() {
      if (currentIndex >= TOTAL_QUESTIONS) return;
      const isCorrect = (basketCount === problem.ans);
      if (isCorrect) {
        score++;
        feedbackEl.className = 'feedback correct';
        feedbackEl.textContent = 'üéâ „Åô„Åî„ÅÑÔºÅ„Åõ„ÅÑ„Åã„ÅÑÔºÅ Great job!';
        popConfetti(40);
        playSuccess();
        currentIndex++;
        updateHUD();
        // 1.2ÁßíÂæå„Å´„Å§„Åé„Å∏
        setTimeout(nextProblem, 1200);
      } else {
        feedbackEl.className = 'feedback incorrect';
        feedbackEl.textContent = 'üòä „ÇÇ„ÅÜ„ÅÑ„Å°„Å©ÔºÅ Try again!';
        playHint();
      }
    }

    function popConfetti(n = 40) {
      const colors = ['#ff4757','#ffa502','#2ed573','#1e90ff','#5352ed','#ff6b81','#70a1ff','#7bed9f'];
      const w = confetti.clientWidth || window.innerWidth;
      for (let i = 0; i < n; i++) {
        const c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random() * w + 'px';
        c.style.background = colors[Math.floor(Math.random() * colors.length)];
        c.style.animationDelay = (Math.random() * 0.2) + 's';
        c.style.transform = `translateY(-20px) rotate(${Math.random()*360}deg)`;
        confetti.appendChild(c);
        setTimeout(() => c.remove(), 1600);
      }
    }

    // „Çµ„Ç¶„É≥„Éâ
    function playTone(freq = 880, dur = 0.2, type = 'sine', gain = 0.06) {
      if (!audioCtx) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g).connect(audioCtx.destination);
      o.start();
      o.stop(audioCtx.currentTime + dur);
    }

    function playSuccess() {
      // Â∞è„Åï„Å™„Ç∏„É≥„Ç∞„É´Ôºà„Éâ„É¨„ÉüÔºâ
      const t0 = audioCtx?.currentTime || 0;
      if (!audioCtx) return;
      const seq = [
        { f: 784, d: 0.12 },
        { f: 988, d: 0.12 },
        { f: 1175, d: 0.18 },
      ];
      let acc = 0;
      for (const s of seq) {
        setTimeout(() => playTone(s.f, s.d, 'triangle', 0.07), acc * 1000);
        acc += s.d * 0.8;
      }
    }

    function playPlop() { playTone(440, 0.06, 'sine', 0.04); }
    function playHint() { playTone(220, 0.18, 'sawtooth', 0.03); }
  </script>
</body>
</html>


