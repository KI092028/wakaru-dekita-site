<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã²ãç®—ã®ç­†ç®—ã‚Œã‚“ã—ã‚…ã†</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSBGNQTYRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YSBGNQTYRZ');
  </script>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --main-blue: #007BFF;
      --main-green: #28A745;
      --main-yellow: #FFC107;
      --main-red: #DC3545;
    }
    
    body {
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    
    .header {
      background: var(--main-blue);
      color: white;
      padding: 1rem 0;
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .calculation-area {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      margin: 2rem auto;
      max-width: 400px;
    }
    
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 3px;
      max-width: 300px;
      margin: 0 auto;
      background: #333;
      padding: 3px;
      border-radius: 10px;
    }
    
    .grid-cell {
      width: 80px;
      height: 80px;
      background: white;
      border: 2px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      border-radius: 5px;
    }
    
    .grid-cell.number {
      background: #f0f8ff;
      border-color: var(--main-blue);
    }
    
    .grid-cell.minus {
      background: #ffe6e6;
      border-color: var(--main-red);
      color: var(--main-red);
    }
    
    .grid-cell.input {
      background: #f0fff0;
      border: 3px solid var(--main-green);
      padding: 0;
    }
    
    .grid-cell.input input {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 2.5rem;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      outline: none;
    }
    
    .grid-cell.input:focus-within {
      border-color: var(--main-yellow);
      box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
    }
    
    .grid-cell.empty {
      background: #f8f9fa;
      border-color: #e9ecef;
    }
    
    .btn-large {
      font-size: 1.2rem;
      padding: 0.8rem 2rem;
      margin: 0.5rem;
      border-radius: 15px;
      font-weight: bold;
    }
    
    .feedback {
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 15px;
    }
    
    .feedback.correct {
      background: #d4edda;
      color: #155724;
      border: 2px solid var(--main-green);
    }
    
    .feedback.incorrect {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid var(--main-red);
    }
    
    .score-display {
      background: var(--main-yellow);
      color: #333;
      padding: 1rem;
      border-radius: 15px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    
    .emoji {
      font-size: 2rem;
      margin: 0 0.5rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ§® ã²ãç®—ã®ç­†ç®—ã‚Œã‚“ã—ã‚…ã† ğŸ§®</h1>
    <p>ç­†ç®—ã§å¼•ãç®—ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†ï¼</p>
  </div>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
        <div class="score-display">
          <span class="emoji">â­</span>
          æ­£è§£æ•°: <span id="correctCount">0</span> / å•é¡Œæ•°: <span id="totalCount">0</span>
          <span class="emoji">â­</span>
        </div>

        <!-- è¨ˆç®—ã‚¨ãƒªã‚¢ -->
        <div class="calculation-area">
          <div class="grid-container" id="calculationGrid">
            <!-- 3x3ã®ãƒã‚¹ç›®ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
          </div>
        </div>

        <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
        <div id="feedback" class="feedback" style="display: none;"></div>

        <!-- ãƒœã‚¿ãƒ³ -->
        <div class="text-center">
          <button class="btn btn-success btn-large" onclick="checkAnswer()">
            <span class="emoji">âœ“</span> ã“ãŸãˆã‚ã‚ã›
          </button>

          <button class="btn btn-primary btn-large" onclick="nextProblem()">
            <span class="emoji">â¡ï¸</span> ã¤ãã®å•é¡Œ
          </button>
          <button class="btn btn-secondary btn-large" onclick="goToMenu()">
            <span class="emoji">ğŸ </span> ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚‚ã©ã‚‹
          </button>
        </div>

        <!-- é›£æ˜“åº¦é¸æŠ -->
        <div class="text-center mt-4">
          <h5>ã‚€ãšã‹ã—ã•ã‚’é¸ã‚“ã§ã­</h5>
          <button class="btn btn-outline-primary" onclick="setDifficulty('easy')">ã‹ã‚“ãŸã‚“ (2æ¡)</button>
          <button class="btn btn-outline-warning" onclick="setDifficulty('medium')">ãµã¤ã† (3æ¡)</button>
          <button class="btn btn-outline-danger" onclick="setDifficulty('hard')">ã‚€ãšã‹ã—ã„ (3æ¡å¤§ãã„æ•°)</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentMinuend = 0;
    let currentSubtrahend = 0;
    let correctAnswer = 0;
    let correctCount = 0;
    let totalCount = 0;
    let difficulty = 'easy';
    let maxDigits = 2;

    // å…¨è§’æ•°å­—ã‚’åŠè§’ã«å¤‰æ›
    function toHalfWidth(str) {
      return str.replace(/[ï¼-ï¼™]/g, function(s) {
        return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
      });
    }

    // 3x3ã‚°ãƒªãƒƒãƒ‰ã‚’ä½œæˆ
    function createGrid() {
      const grid = document.getElementById('calculationGrid');
      grid.innerHTML = '';
      
      // 9å€‹ã®ã‚»ãƒ«ã‚’ä½œæˆ
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement('div');
        cell.className = 'grid-cell empty';
        cell.id = `cell-${i}`;
        grid.appendChild(cell);
      }
    }

    // æ•°å­—ã‚’å³è©°ã‚ã§é…ç½®ã™ã‚‹ä½ç½®ã‚’è¨ˆç®—
    function getPositions(digits, maxDigits) {
      const positions = [];
      const startPos = 3 - maxDigits; // å³è©°ã‚ã®é–‹å§‹ä½ç½®
      
      for (let i = 0; i < digits.length; i++) {
        positions.push(startPos + i);
      }
      return positions;
    }

    // è¨ˆç®—è¡¨ç¤ºã‚’æ›´æ–°
    function updateDisplay() {
      createGrid();
      
      const minuendStr = currentMinuend.toString();
      const subtrahendStr = currentSubtrahend.toString();
      
      // è¢«æ¸›æ•°ã‚’ä¸Šæ®µå³è©°ã‚ã§é…ç½®
      const minuendPositions = getPositions(minuendStr.split(''), maxDigits);
      minuendStr.split('').forEach((digit, index) => {
        const cell = document.getElementById(`cell-${minuendPositions[index]}`);
        cell.textContent = digit;
        cell.className = 'grid-cell number';
      });
      
      // ãƒã‚¤ãƒŠã‚¹è¨˜å·ã‚’ä¸­æ®µå·¦ç«¯ã«é…ç½®
      const minusCell = document.getElementById('cell-3');
      minusCell.textContent = 'ï¼';
      minusCell.className = 'grid-cell minus';
      
      // æ¸›æ•°ã‚’ä¸­æ®µå³è©°ã‚ã§é…ç½®ï¼ˆä¸€æ¡ã®å ´åˆã¯ä¸€ã®ä½ã«é…ç½®ï¼‰
      const subtrahendDigits = subtrahendStr.split('');
      const subtrahendStartPos = 3 - subtrahendDigits.length; // å³è©°ã‚ã®é–‹å§‹ä½ç½®ã‚’è¨ˆç®—
      subtrahendDigits.forEach((digit, index) => {
        const cellIndex = 3 + subtrahendStartPos + index;
        const cell = document.getElementById(`cell-${cellIndex}`);
        cell.textContent = digit;
        cell.className = 'grid-cell number';
      });
      
      // ç­”ãˆå…¥åŠ›æ¬„ã‚’å„ä½ã«å¯¾å¿œã—ã¦é…ç½®
      for (let i = 0; i < maxDigits; i++) {
        const cell = document.getElementById(`cell-${6 + (3 - maxDigits) + i}`);
        cell.className = 'grid-cell input';
        const input = document.createElement('input');
        input.type = 'text';
        input.maxLength = 1;
        input.id = `answer-${i}`;
        input.addEventListener('input', handleDigitInput);
        input.addEventListener('keydown', handleKeyDown);
        cell.appendChild(input);
      }
    }

    // æ•°å­—å…¥åŠ›ã®å‡¦ç†
    function handleDigitInput(event) {
      const input = event.target;
      let value = toHalfWidth(input.value);
      
      // æ•°å­—ä»¥å¤–ã‚’é™¤å»
      value = value.replace(/[^0-9]/g, '');
      
      if (value.length > 1) {
        value = value.slice(-1);
      }
      
      input.value = value;
      
      // æ¬¡ã®å…¥åŠ›æ¬„ã«ç§»å‹•
      if (value && input.nextElementSibling) {
        input.nextElementSibling.focus();
      }
    }

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®å‡¦ç†
    function handleKeyDown(event) {
      const input = event.target;
      
      if (event.key === 'Backspace' && !input.value && input.previousElementSibling) {
        input.previousElementSibling.focus();
      } else if (event.key === 'ArrowLeft' && input.previousElementSibling) {
        input.previousElementSibling.focus();
      } else if (event.key === 'ArrowRight' && input.nextElementSibling) {
        input.nextElementSibling.focus();
      } else if (event.key === 'Enter') {
        checkAnswer();
      }
    }

    // é›£æ˜“åº¦è¨­å®š
    function setDifficulty(level) {
      difficulty = level;
      maxDigits = level === 'easy' ? 2 : 3;
      nextProblem();
      
      // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°
      document.querySelectorAll('.btn-outline-primary, .btn-outline-warning, .btn-outline-danger').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // æ–°ã—ã„å•é¡Œã‚’ç”Ÿæˆ
    function generateProblem() {
      let minuend, subtrahend;
      
      switch(difficulty) {
        case 'easy':
          minuend = Math.floor(Math.random() * 90) + 10; // 10-99
          subtrahend = Math.floor(Math.random() * (minuend - 1)) + 1;
          maxDigits = 2;
          break;
        case 'medium':
          minuend = Math.floor(Math.random() * 900) + 100; // 100-999
          subtrahend = Math.floor(Math.random() * (minuend - 1)) + 1;
          maxDigits = 3;
          break;
        case 'hard':
          minuend = Math.floor(Math.random() * 900) + 500; // 500-999
          subtrahend = Math.floor(Math.random() * (minuend - 100)) + 100;
          maxDigits = 3;
          break;
      }
      
      currentMinuend = minuend;
      currentSubtrahend = subtrahend;
      correctAnswer = minuend - subtrahend;
      
      updateDisplay();
      document.getElementById('feedback').style.display = 'none';
    }

    // ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
    function checkAnswer() {
      let userAnswerStr = '';
      let hasInput = false;
      
      // å„ä½ã®å…¥åŠ›ã‚’å–å¾—ï¼ˆå·¦ã‹ã‚‰å³ã¸ï¼‰
      for (let i = 0; i < maxDigits; i++) {
        const input = document.getElementById(`answer-${i}`);
        if (input) {
          const value = input.value || '0';
          userAnswerStr += value;
          if (value !== '0' && value !== '') {
            hasInput = true;
          }
        }
      }
      
      const userAnswer = parseInt(userAnswerStr);
      const feedbackElement = document.getElementById('feedback');
      
      if (!hasInput) {
        feedbackElement.innerHTML = '<span class="emoji">â“</span> æ•°å­—ã‚’å…¥åŠ›ã—ã¦ã­ï¼';
        feedbackElement.className = 'feedback incorrect';
        feedbackElement.style.display = 'block';
        return;
      }
      
      totalCount++;
      
      if (userAnswer === correctAnswer) {
        correctCount++;
        feedbackElement.innerHTML = '<span class="emoji">ğŸ‰</span> ã‚ˆãã§ãã¾ã—ãŸï¼ <span class="emoji">ğŸ‘</span>';
        feedbackElement.className = 'feedback correct';
      } else {
        feedbackElement.innerHTML = `<span class="emoji">ğŸ’ª</span> ã‚‚ã†ä¸€åº¦ã‚„ã£ã¦ã¿ã‚ˆã†ï¼æ­£è§£ã¯ ${correctAnswer} ã§ã™ <span class="emoji">ğŸ“</span>`;
        feedbackElement.className = 'feedback incorrect';
      }
      
      feedbackElement.style.display = 'block';
      updateScore();
    }

    // æ¬¡ã®å•é¡Œ
    function nextProblem() {
      generateProblem();
    }

    // ã‚¹ã‚³ã‚¢æ›´æ–°
    function updateScore() {
      document.getElementById('correctCount').textContent = correctCount;
      document.getElementById('totalCount').textContent = totalCount;
    }

    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
    function goToMenu() {
      if (confirm('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
        window.history.back();
      }
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      generateProblem();
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€Œã‹ã‚“ãŸã‚“ã€ã‚’é¸æŠçŠ¶æ…‹ã«
      document.querySelector('.btn-outline-primary').classList.add('active');
    });
  </script>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96bf37c6f7df0087',t:'MTc1NDY1ODI0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>



